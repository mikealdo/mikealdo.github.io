<!DOCTYPE html>
<html>
  <head>
    <title>Components hacked into Struts2</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    
    <link rel="apple-touch-icon" sizes="57x57" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-57x57.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="60x60" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-60x60.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="72x72" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-72x72.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="76x76" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-76x76.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="114x114" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-114x114.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="120x120" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-120x120.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="144x144" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-144x144.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="152x152" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-152x152.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="180x180" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-180x180.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon-32x32.png?v=wAAv6Wqe6l?v=1.0.0" sizes="32x32">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon-194x194.png?v=wAAv6Wqe6l?v=1.0.0" sizes="194x194">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon-96x96.png?v=wAAv6Wqe6l?v=1.0.0" sizes="96x96">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/android-chrome-192x192.png?v=wAAv6Wqe6l?v=1.0.0" sizes="192x192">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon-16x16.png?v=wAAv6Wqe6l?v=1.0.0" sizes="16x16">
    <link rel="manifest" href="//mikealdo.github.io/themes/uno-zen/assets/img/manifest.json?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="shortcut icon" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon.ico?v=wAAv6Wqe6l?v=1.0.0">
    <meta name="msapplication-TileColor" content="#e74c3c">
    <meta name="msapplication-TileImage" content="//mikealdo.github.io/themes/uno-zen/assets/img/mstile-144x144.png?v=wAAv6Wqe6l?v=1.0.0">
    <meta name="msapplication-config" content="//mikealdo.github.io/themes/uno-zen/assets/img/browserconfig.xml?v=wAAv6Wqe6l?v=1.0.0">
    <meta name="theme-color" content="#e74c3c">
    <link rel="stylesheet" type="text/css" href="//mikealdo.github.io/themes/uno-zen/assets/css/uno-zen.css?v=1.0.0" />
    <link rel="canonical" href="https://mikealdo.github.io/2015/12/08/Components-hacked-into-Struts2-java-web-framework.html" />
    
    <meta property="og:site_name" content="Michal Davídek - blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Components hacked into Struts2" />
    <meta property="og:description" content="Have you ever hack (customize, rework) some software framework to do something which was not in framework design? No? I haven’t your lucky so there is a short story about hacking Struts2 web framework to be able use “components”..." />
    <meta property="og:url" content="https://mikealdo.github.io/2015/12/08/Components-hacked-into-Struts2-java-web-framework.html" />
    <meta property="og:image" content="https://mikealdo.github.io/images/covers/components-hacked-into-struts2.jpg" />
    <meta property="article:published_time" content="2015-12-07T23:00:00.000Z" />
    <meta property="article:modified_time" content="2016-03-01T19:31:29.005Z" />
    <meta property="article:tag" content="struts2" />
    <meta property="article:tag" content="components" />
    <meta property="article:tag" content="architecture" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Components hacked into Struts2" />
    <meta name="twitter:description" content="Have you ever hack (customize, rework) some software framework to do something which was not in framework design? No? I haven’t your lucky so there is a short story about hacking Struts2 web framework to be able use “components”..." />
    <meta name="twitter:url" content="https://mikealdo.github.io/2015/12/08/Components-hacked-into-Struts2-java-web-framework.html" />
    <meta name="twitter:image:src" content="https://mikealdo.github.io/images/covers/components-hacked-into-struts2.jpg" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Michal Davídek - blog",
    "author": {
        "@type": "Person",
        "name": "Michal Davídek",
        "image": "https://avatars.githubusercontent.com/u/14245058?v=3",
        "url": "undefined/author/undefined",
        "sameAs": null
    },
    "headline": "Components hacked into Struts2",
    "url": "https://mikealdo.github.io/2015/12/08/Components-hacked-into-Struts2-java-web-framework.html",
    "datePublished": "2015-12-07T23:00:00.000Z",
    "dateModified": "2016-03-01T19:31:29.005Z",
    "image": "https://mikealdo.github.io/images/covers/components-hacked-into-struts2.jpg",
    "keywords": "struts2,  components,  architecture",
    "description": "Have you ever hack (customize, rework) some software framework to do something which was not in framework design? No? I haven’t your lucky so there is a short story about hacking Struts2 web framework to be able use “components”..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Michal Davídek - blog" href="https://mikealdo.github.io/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
  </head>
  <body class="post-template tag-struts2 tag-components tag-architecture">
    <header id="menu-button" class="expanded">
      <a><i class="icon icon-list"></i></a>
    </header>
    <aside class="cover" style="background: url(/images/background-cover.jpg) center/cover no-repeat fixed">
      <div class="cover container">
        <div class="profile">
          <a id="avatar-link" title="link to homepage for Michal Davídek - blog" href="https://mikealdo.github.io/#open">
            <img src="/images/michal-davidek.png" alt="Michal Davídek - blog avatar" class="profile avatar rounded hvr-buzz-out" />
            <h1 id="profile-title">Michal Davídek - blog</h1>
            <h3 id="profile-resume"></h3>
          </a>
    
          <hr class="divider long" />
          <p>Architecture, coding, open source.</p>
          <hr class="divider short" />
          <div class="navigation">
            <div class="profile contact">
              
              <nav class="navigation right">
                <ul class="social expanded">
              
              
                  <!-- Twitter -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://twitter.com/mikealdo007" title="Twitter account">
                      <i class='icon icon-social-twitter'></i>
                      <span class="label">Twitter</span>
                    </a>
                  </li>
              
                  <!-- Google Plus -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://plus.google.com/+MichalDavidekCZ" title="Google+ account">
                      <i class='icon icon-social-google-plus'></i>
                      <span class="label">Google-plus</span>
                    </a>
                  </li>
              
                  <!-- Github -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://github.com/mikealdo" title="Github account">
                      <i class='icon icon-social-github'></i>
                      <span class="label">Github</span>
                    </a>
                  </li>
                  </li>
              
              
              
              
                  <!-- LinkedIn -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://www.linkedin.com/in/davidekmichal" title="LinkedIn account">
                      <i class='icon icon-social-linkedin'></i>
                      <span class="label">LinkedIn</span>
                    </a>
                  </li>
              
                  <!-- Email -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="mailto:mdavidek1@gmail.com" title="Email mdavidek1@gmail.com">
                      <i class='icon icon-mail'></i>
                      <span class="label">Email</span>
                    </a>
                  </li>
              
                </ul>
              </nav>
              <!-- <section class="icon icon-search" id="search-container">
      <hr class="divider short" />
      <form id="search-form">
        <input type="text", name="search", placeholder="git, css, javascript,..." id="search-field" />
      </form>
    </section>
     -->
            </div>
          </div>
        </div>
      </div>
    </aside>
    <main>
      <section id="search-results"></section>
      <section class="content">
        

  <article class="post tag-struts2 tag-components tag-architecture">
    <header>
      <div class="post meta">
        <time datetime="08 Dec 2015">08 Dec 2015</time>
        <span class="post tags">in <a href="https://mikealdo.github.io/tag/struts2">struts2</a> <a href="https://mikealdo.github.io/tag/components"> components</a> <a href="https://mikealdo.github.io/tag/architecture"> architecture</a></span>


        <span class="post reading-time"> ~ <span></span> read.</span>
      </div>
      <a alt="Tweet 'Components hacked into Struts2'" href="https://twitter.com/intent/tweet?text=Components%20hacked%20into%20Struts2%20%C2%BB&amp;hashtags=struts2, components, architecture&amp;url=https://mikealdo.github.io/2015/12/08/Components-hacked-into-Struts2-java-web-framework.html">
        <img id="post-image" src=https://mikealdo.github.io/images/covers/components-hacked-into-struts2.jpg alt="Components hacked into Struts2">
        <h1 class="icon-reverse icon-social-twitter-post" id="post-title">Components hacked into Struts2</h1>
      </a>
    </header>

    <div id="post-content" class="post tag-struts2 tag-components tag-architecture">
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Have you ever hack (customize, rework) some software framework to do something which was not in framework design? No? I haven’t your lucky so there is a short story about hacking Struts2 web framework to be able use “components” aka for example JSF components. Yes, it’s strange because the main reason why to use Struts2 is their design to have only one Action class per one page serving content for view layer. But when you are on project which has some feature request which is impossible to do with this pattern and no chance to rewrite all the client software stack to use another framework … so read on.</p>
</div>
<div class="paragraph">
<p><strong>Disclaimer</strong>: Even when I think that Struts2 are no longer reasoable option for producing new software I spent with this framework valuable time and I think that this can be useful for such sufferer who are still fighting with it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_be_an_manager_of_yourself">Be an manager of yourself</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This story is about software on which I was working 4 years ago. Maybe I am more experienced to say to managers NO now but at the time of writing this hack I was not so skilled. Even when now I know that the best software/feature is software/feature which is never written, in that project there were so many hacks that I and one of my colleague decided to be two more hackers (and from egoism perspective it was fun ;)). So if you find this blog post useful, I strongly recommend to see your decision from broader perspective and try to not use it because it can lead to hardly maintainable software, badly responsible applications and of course risk that with next minor update of Struts2 libraries can your application not work anymore (but surprisingly 4 years old code works with current version of Struts2, cool). Be a manager of yourself and use existing solutions which are designed to be your servant and not vice versa.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hacking_interceptors">Hacking interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Two things I hate on Struts2 - possibility to create stacks of interceptors which can inherit from each other and there is no built-in check if some interceptor is not called twice before request. Maybe this changed recently, I don’t know but this (after several years of improving some software) leads to hardly maintainable .xml files with many stacks of interceptors just because we can do it and didn’t thinking about maintainability. But conceptually we can say that as a corner stone of Struts2 framework interceptors works in good manner and I will show you how to become interceptor master in 10 minutes.</p>
</div>
<div class="paragraph">
<p>Second thing is inevitable tension to use inheritance in Action classes to reuse code. This simply leads to expectedly deep hierarchy of abstract and concrete classes which adding/disabling features here and there. And what you can do if you have two abstract action classes with some functionality and would like to use it in one page? Bad luck! So no more sharing code through class hierarchy anymore.</p>
</div>
<div class="paragraph">
<p>To be frank to software which I was writing, it was not good piece of code. Legacy (sometimes 12+ years old) code, not refactored code, big technical debt backlog, missing tests, many proprietary solutions, old versions of open source libraries. But for obviously understandable reasons (money and broad portfolio of customers) software has living his own life. And without feeling of rewriting it (which was almost impossible due to expected constraints) we were developed solution for reuse code inside Struts2 solution (at the time of writing code I am not aware about any other solution on top of Struts2).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_be_an_architect">Be an architect</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After reading such useful thing as a <a href="https://www.manning.com/books/struts-2-in-action">Struts 2 in action</a> book, I was aware about interceptors, process of action and method invocation, approach for saving values into session and from/to request/response so I was able to design our hack. It’s based on custom overridden implementation of actions invocation functionality as we can see on picture below (see exclamation marks):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/posts/struts-architecture-improved.png" alt="struts architecture improved.png" width="400">
</div>
<div class="title">Figure 1. Improved default Struts2 architecture</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_component_model">Component model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Action is a Page. Action has a component(s). Component can have reference to Page. Component can be the Page itself.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/posts/component-model.png" alt="component model.png" width="400">
</div>
<div class="title">Figure 2. Component model</div>
</div>
<div class="sect2">
<h3 id="_concrete_component">Concrete component</h3>
<div class="paragraph">
<p>So quite easy model but the biggest problem here is how to call methods (aka business logic) inside component without needed to have boilerplate code inside parent Action to recalling components. So we would like to not have this inside action class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Action.sayHelloInSomeComponent() {
     someComponent.sayHello();
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/posts/concrete-component.png" alt="concrete component.png" width="300">
</div>
<div class="title">Figure 3. Concrete component</div>
</div>
<div class="paragraph">
<p>But Struts2 invocation is not generic, doesn’t find methods inside inner fields. So here is a first hack - <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/DefaultActionInvocation.java">DefaultActionInvocation</a>. We would like to have a algorithm which resolve method even inside inner field (if field is marked as Component). This method can be represented by dot notation on the view layer (links etc.) - “someComponent.sayHello” and which in fact doesn’t adding mess to parent action. See creation of link by Freemarker templating engine <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/webapp/ftl/index.ftl">here</a>. So at the first sight it should be easy to hack, but after some elaboration we ended with quite huge reworking of this class and some other were needed to adjust also - <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/DefaultWorkflowInterceptor.java">DefaultWorkflowInterceptor</a>, <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/DefaultActionProxyFactory.java">DefaultActionProxyFactory</a>, <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/StrutsActionProxyFactory.java">StrutsActionProxyFactory</a> and <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/AnnotationValidationInterceptor.java">AnnotationValidationInterceptor</a>. Although it seems a lot of code inside reworked classes, all the important changed code is between comments “// Struts components” and “// END OF Struts components”. See concrete example in <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/components/SecondSimpleComponent.java">SecondSimpleComponent</a>.</p>
</div>
<div class="paragraph">
<p>Also there is a need to load overridden <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/resources/struts-overridden-default.xml">struts-default.xml</a> due to need of redefining just mentioned classes by using <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/StrutsWithComponentsPrepareFilter.java">StrutsWithComponentsPrepareFilter</a>.</p>
</div>
<div class="paragraph">
<p>After being able to call business logic inside components we need to way how to save properties of components inside session. There is <a href="https://struts.apache.org/docs/scope-interceptor.html">ScopeInterceptor</a> which handles this with  configuration of session fields inside xml. Instead of this we introduce annotation <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/annotations/SessionField.java">@SessionField</a> and <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/SessionFieldInterceptor.java">SessionFieldInterceptor</a> which handles session scoped variables for you. It can be used instead of ScopeInterceptor because it’s working for both cases - inside Action and inside Component.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/ComponentOnPageInitInterceptor.java">ComponentOnPageAwareInterceptor</a> only set reference to Components which are marked with <a href="https://github.com/mikealdo/struts2components/blob/master/src/main/java/cz/mikealdo/struts2components/struts2/components/ComponentOnPageAware.java">ComponentOnPageAware</a> interface to be able for example share some useful information between inner components.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_view_layer">View layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In that project we were using Freemarker so I am using it in example source code as well. I doesn’t see problem to use any other templating engine for your view layer. Also we developed way how to call components logic through AJAX but it’s not part of this blog post. If you are interested in just leave a comment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_i_can_say_more">What I can say more?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On my GitHub is <a href="https://github.com/mikealdo/struts2components">working example</a> of one Action with two same components and it’s working with the latest Struts2 version. In mentioned project we implemented surprisingly complex components on top of it (and added some of additional common functionality) like a tables, search engine and graph components. It worked quite good and there were no significant performance problems with this hack itself. I would be glad for your comments on our solution and especially negative comments for whole approach.</p>
</div>
<div class="paragraph">
<p><strong>P.S.</strong> If you enjoyed reading this blog post, could you do me favor and tweet it? Thanks!</p>
</div>
</div>
</div>
    </div>

    <div class="post related">

    </div>

    <footer class="post comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname = 'mikealdo'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>

  </article>


        <footer>
          <span class="copyright">
            &copy; 2016. All rights reserved. Built with <a href="https://github.com/Kikobeats/uno-zen" target="_blank">Uno Zen</a> under <a href="http://hubpress.io/" target="_blank">HubPress</a>.
          </span>
        </footer>
      </section>
    </main>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>
    <script src="//mikealdo.github.io/themes/uno-zen/assets/js/uno-zen.js?v=1.0.0" type="text/javascript" charset="utf-8"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-72815761-1', 'auto');
    ga('send', 'pageview');

    </script>
  </body>
</html>
