<!DOCTYPE html>
<html>
  <head>
    <title>Multiple libraries for assertions in your test classpath</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    
    <link rel="apple-touch-icon" sizes="57x57" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-57x57.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="60x60" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-60x60.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="72x72" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-72x72.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="76x76" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-76x76.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="114x114" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-114x114.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="120x120" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-120x120.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="144x144" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-144x144.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="152x152" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-152x152.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="apple-touch-icon" sizes="180x180" href="//mikealdo.github.io/themes/uno-zen/assets/img/apple-touch-icon-180x180.png?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon-32x32.png?v=wAAv6Wqe6l?v=1.0.0" sizes="32x32">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon-194x194.png?v=wAAv6Wqe6l?v=1.0.0" sizes="194x194">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon-96x96.png?v=wAAv6Wqe6l?v=1.0.0" sizes="96x96">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/android-chrome-192x192.png?v=wAAv6Wqe6l?v=1.0.0" sizes="192x192">
    <link rel="icon" type="image/png" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon-16x16.png?v=wAAv6Wqe6l?v=1.0.0" sizes="16x16">
    <link rel="manifest" href="//mikealdo.github.io/themes/uno-zen/assets/img/manifest.json?v=wAAv6Wqe6l?v=1.0.0">
    <link rel="shortcut icon" href="//mikealdo.github.io/themes/uno-zen/assets/img/favicon.ico?v=wAAv6Wqe6l?v=1.0.0">
    <meta name="msapplication-TileColor" content="#e74c3c">
    <meta name="msapplication-TileImage" content="//mikealdo.github.io/themes/uno-zen/assets/img/mstile-144x144.png?v=wAAv6Wqe6l?v=1.0.0">
    <meta name="msapplication-config" content="//mikealdo.github.io/themes/uno-zen/assets/img/browserconfig.xml?v=wAAv6Wqe6l?v=1.0.0">
    <meta name="theme-color" content="#e74c3c">
    <link rel="stylesheet" type="text/css" href="//mikealdo.github.io/themes/uno-zen/assets/css/uno-zen.css?v=1.0.0" />
    <link rel="canonical" href="https://mikealdo.github.io/2016/04/01/Multiple-libraries-for-assertions-in-your-test-classpath.html" />
    
    <meta property="og:site_name" content="Michal Davídek - blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Multiple libraries for assertions in your test classpath" />
    <meta property="og:description" content="You know that situation &amp;#8230;&amp;#8203; You are joining some bigger project based on Java technologies and there is 99 percent certainty that there will be several libraries used for unit testing and assertions inside. If you have good luck,..." />
    <meta property="og:url" content="https://mikealdo.github.io/2016/04/01/Multiple-libraries-for-assertions-in-your-test-classpath.html" />
    <meta property="og:image" content="https://mikealdo.github.io/images//covers/multiple-libraries-in-your-test-classpath.jpeg" />
    <meta property="article:published_time" content="2016-03-31T22:00:00.000Z" />
    <meta property="article:modified_time" content="2016-05-11T14:45:38.773Z" />
    <meta property="article:tag" content="unit testing" />
    <meta property="article:tag" content="libraries" />
    <meta property="article:tag" content="architecture" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Multiple libraries for assertions in your test classpath" />
    <meta name="twitter:description" content="You know that situation &amp;#8230;&amp;#8203; You are joining some bigger project based on Java technologies and there is 99 percent certainty that there will be several libraries used for unit testing and assertions inside. If you have good luck,..." />
    <meta name="twitter:url" content="https://mikealdo.github.io/2016/04/01/Multiple-libraries-for-assertions-in-your-test-classpath.html" />
    <meta name="twitter:image:src" content="https://mikealdo.github.io/images//covers/multiple-libraries-in-your-test-classpath.jpeg" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Michal Davídek - blog",
    "author": {
        "@type": "Person",
        "name": "Michal Davídek",
        "image": "https://avatars.githubusercontent.com/u/14245058?v=3",
        "url": "undefined/author/undefined",
        "sameAs": null
    },
    "headline": "Multiple libraries for assertions in your test classpath",
    "url": "https://mikealdo.github.io/2016/04/01/Multiple-libraries-for-assertions-in-your-test-classpath.html",
    "datePublished": "2016-03-31T22:00:00.000Z",
    "dateModified": "2016-05-11T14:45:38.773Z",
    "image": "https://mikealdo.github.io/images//covers/multiple-libraries-in-your-test-classpath.jpeg",
    "keywords": "unit testing,  libraries,  architecture",
    "description": "You know that situation &amp;#8230;&amp;#8203; You are joining some bigger project based on Java technologies and there is 99 percent certainty that there will be several libraries used for unit testing and assertions inside. If you have good luck,..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Michal Davídek - blog" href="https://mikealdo.github.io/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
  </head>
  <body class="post-template tag-unit-testing tag-libraries tag-architecture">
    <header id="menu-button" class="expanded">
      <a><i class="icon icon-list"></i></a>
    </header>
    <aside class="cover" style="background: url(/images/background-cover.jpg) center/cover no-repeat fixed">
      <div class="cover container">
        <div class="profile">
          <a id="avatar-link" title="link to homepage for Michal Davídek - blog" href="https://mikealdo.github.io/#open">
            <img src="/images/michal-davidek.png" alt="Michal Davídek - blog avatar" class="profile avatar rounded hvr-buzz-out" />
            <h1 id="profile-title">Michal Davídek - blog</h1>
            <h3 id="profile-resume"></h3>
          </a>
    
          <hr class="divider long" />
          <p>Architecture, coding, open source.</p>
          <hr class="divider short" />
          <div class="navigation">
            <div class="profile contact">
              
              <nav class="navigation right">
                <ul class="social expanded">
              
              
                  <!-- Twitter -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://twitter.com/mikealdo007" title="Twitter account">
                      <i class='icon icon-social-twitter'></i>
                      <span class="label">Twitter</span>
                    </a>
                  </li>
              
                  <!-- Google Plus -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://plus.google.com/+MichalDavidekCZ" title="Google+ account">
                      <i class='icon icon-social-google-plus'></i>
                      <span class="label">Google-plus</span>
                    </a>
                  </li>
              
                  <!-- Github -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://github.com/mikealdo" title="Github account">
                      <i class='icon icon-social-github'></i>
                      <span class="label">Github</span>
                    </a>
                  </li>
                  </li>
              
              
              
              
                  <!-- LinkedIn -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://www.linkedin.com/in/davidekmichal" title="LinkedIn account">
                      <i class='icon icon-social-linkedin'></i>
                      <span class="label">LinkedIn</span>
                    </a>
                  </li>
              
                  <!-- Email -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="mailto:mdavidek1@gmail.com" title="Email mdavidek1@gmail.com">
                      <i class='icon icon-mail'></i>
                      <span class="label">Email</span>
                    </a>
                  </li>
                    <!-- RSS -->
                    <li class="social item hvr-grow-rotate">
                        <a href="/rss/" title="Subscribe to RSS">
                            <i class='icon icon-rss'></i>
                            <span class="label">RSS</span>
                        </a>
                    </li>
                </ul>
              </nav>
              <!-- <section class="icon icon-search" id="search-container">
      <hr class="divider short" />
      <form id="search-form">
        <input type="text", name="search", placeholder="git, css, javascript,..." id="search-field" />
      </form>
    </section>
     -->
            </div>
          </div>
        </div>
      </div>
    </aside>
    <main>
      <section id="search-results"></section>
      <section class="content">
        

  <article class="post tag-unit-testing tag-libraries tag-architecture">
    <header>
      <div class="post meta">
        <time datetime="01 Apr 2016">01 Apr 2016</time>
        <span class="post tags">in <a href="https://mikealdo.github.io/tag/unit-testing">unit testing</a> <a href="https://mikealdo.github.io/tag/libraries"> libraries</a> <a href="https://mikealdo.github.io/tag/architecture"> architecture</a></span>


        <span class="post reading-time"> ~ <span></span> read.</span>
      </div>
      <a alt="Tweet 'Multiple libraries for assertions in your test classpath'" href="https://twitter.com/intent/tweet?text=Multiple%20libraries%20for%20assertions%20in%20your%20test%20classpath%20%C2%BB&amp;hashtags=unit testing, libraries, architecture&amp;url=https://mikealdo.github.io/2016/04/01/Multiple-libraries-for-assertions-in-your-test-classpath.html">
        <img id="post-image" src=https://mikealdo.github.io/images//covers/multiple-libraries-in-your-test-classpath.jpeg alt="Multiple libraries for assertions in your test classpath">
        <h1 class="icon-reverse icon-social-twitter-post" id="post-title">Multiple libraries for assertions in your test classpath</h1>
      </a>
    </header>

    <div id="post-content" class="post tag-unit-testing tag-libraries tag-architecture">
      <div class="sect1">
<h2 id="_you_know_that_situation">You know that situation &#8230;&#8203;</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You are joining some bigger project based on Java technologies and there is 99 percent certainty that there will be several libraries used for unit testing and assertions inside. If you have good luck, there will be no in-house developed library. When you are asking which one is the preferred one, each team member will claim his favourite one. Also for your team leads or architects or other decision makers is not clear when this stack of libraries became to grow and what is the preferred one to use. Even in code reviews is usage of such libraries disregarded often. If this is not your case, you can stop reading this, but in other case … read on.</p>
</div>
<div class="sect2">
<h3 id="_i_have_opinion_that_multiple_assertion_libraries_on_test_classpath_is_bad">I have opinion that multiple assertion libraries on test classpath is bad</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It increases mess in tests.</p>
</li>
<li>
<p>In decreases readability of tests.</p>
</li>
<li>
<p>Can cause overlooking of missing assertions.</p>
</li>
<li>
<p>Can cause overlooking of badly written assertions. (Do you know that in TestNG and JUnit are parameters (<strong>actual, expected</strong>) inside assert methods switched?)</p>
</li>
<li>
<p>There is decent chance that the problem will be growing in time.</p>
</li>
<li>
<p>Refactoring of “older” tests is not happening.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_the_real_problem">What is the real problem?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So you have multiple libraries on your test classpath providing some assertion classes by default. Real problem is, that you are unable to avoid multiplicity in the assertions libraries due to fact, that mainly used frameworks used in Java world - <a href="http://junit.org/junit4/">JUnit</a> and <a href="http://testng.org/doc/index.html">TestNG</a> - have built-in assertions classes. These classes often does not offer best way how to asserts so you have temptation to use another one even for simplest assertion. The most used is in my opinion <a href="http://joel-costigliola.github.io/assertj/">AssertJ</a>. <a href="http://mockito.org/">Mockito</a> (and other mocking libraries) brings another set of assertions. With <a href="http://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/util/Assert.html">spring</a> it comes another set of assertions. And have {guava-link} in your classpath as well? Another Assert class there. Are you geeky and have <a href="http://google.github.io/truth/">google truth</a> on your test classpath as well? Well, it’s obvious that you have four or five classes which has even same name - Assert. It’s really annoying to even static import right assert with such count of same classes providing similar API.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_rid_of_problems">Getting rid of problems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Well, in my experience is impossible to avoid having multiple libraries providing some assertions facility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You need mocking library for unit tests.</p>
</li>
<li>
<p>You need spring framework for you integration tests. (unless you are using spring in your project of course)</p>
</li>
<li>
<p>You need test framework to be able run the tests at all.</p>
</li>
<li>
<p>You are unsatisfied with readability and usability test framework built-in API for assertions.</p>
</li>
<li>
<p>And if you aren’t on green field project, getting rid of several libraries is the neverending story.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So how to ensure that is used only your desired one?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up of your IDE to provide only desired assertion library.</p>
</li>
<li>
<p>Quality assurance tests.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>I am using <a href="https://www.jetbrains.com/idea/">Intellij IDEA</a> and when you are static importing some class, you have a choice to disable providing particular class. This comes handy for newly written tests but when you are facing older tests you haven’t such a choice because there are asserts from other library. It’s clear that if you would like to have consistent way for asserting, you will need to rewrite all the tests which are not passing your criterias and clear your dependencies. This is step one. Step two is ensuring  that your test codebase follow coding standards and static analysis tools are unable to do this hard work for you. So you need the specialized test (quality assurance test) for checking that your test codebase meets criteria set by coding standards. In one project we have written tests for checking right annotations for test classes for integration and unit tests. Also there can be a test which is verifying that you are not importing assertions from other than preferred libraries - it’s not so easy to getting rid of not preferred libraries from dependencies in one step.</p>
</div>
<div class="paragraph">
<p>Test bellow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>reads all the test classes from package</p>
</li>
<li>
<p>finds if there are dependencies for Google Truth</p>
</li>
<li>
<p>prints messages which classes aren’t following coding standards</p>
</li>
<li>
<p><a href="https://github.com/mikealdo/multiple-assertions-libraries">whole project with dependencies here</a></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>@Test
public void shouldVerifyOnlyOneAssertionLibraryInAllTheTests() throws Exception {
    DependencyVisitor v = new DependencyVisitor();
    for (Class&lt;?&gt; aClass : classes) {
        String resourceName = "/cz/mikealdo/tests/" + aClass.getSimpleName() + ".class";
        InputStream resourceAsStream = aClass.getResourceAsStream(resourceName);
        new ClassReader(resourceAsStream).accept(v, 0);
        Set&lt;String&gt; classPackages = v.getPackages();
        for (String classPackage : classPackages) {
            if (classPackage.contains("com/google/common/truth")) {
                System.err.println("Google Truth library is not allowed for using in class " + aClass.getSimpleName());
            }
        }
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_else">What else</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is my list of best practices for keeping test classpath clean:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One mocking library at most.</p>
</li>
<li>
<p>One assertion library per module.</p>
</li>
<li>
<p>Ideally one assertion library per project.</p>
</li>
<li>
<p>Continuously getting rid of deprecated asserts in older tests.</p>
</li>
<li>
<p>Replace google guava with Java 8 features (in case that you are on Java 8 already).</p>
</li>
<li>
<p>Unified way for exception assertions.</p>
</li>
<li>
<p>When you plan to use <a href="https://github.com/spockframework">spock</a>, separate this usage into separate module.</p>
</li>
<li>
<p>Even when <a href="http://hamcrest.org/JavaHamcrest/">Hamcrest</a> was good choice at previous times, use <a href="http://joel-costigliola.github.io/assertj/">AssertJ</a> instead and remove it from your dependencies.</p>
</li>
<li>
<p>When you plan to use cucumber, separate this testing approach into separate module.</p>
</li>
<li>
<p>Develop coding standards even for tests.</p>
</li>
<li>
<p>Develop as much as quality assurance tests you can to ensure that coding standards are followed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_in_conclusion">In conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We should treat our testing codebase as a first class citizen and enforce same coding standards as we have for production codebase. Also we should continuously improve test codebase by refactoring and enhancing approaches used in tests. By using multiply assertions libraries you are giving developers opportunities to easily override coding standards which can be easily overlooked in code reviews. So exclusive use of one or other library might help to have consistently written tests even when it’s possible to have several ones on classpath.</p>
</div>
<div class="paragraph">
<p><strong>P.S.</strong> Follow me on <a href="https://twitter.com/mikealdo007">twitter</a>.</p>
</div>
<div class="paragraph">
<p><strong>P.S.2</strong> Cover image by <a href="https://unsplash.com/photos/f6Xv0xs9JWg">Mike Petrucci | UnSplash</a></p>
</div>
</div>
</div>
    </div>

    <div class="post related">

    </div>

    <footer class="post comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname = 'mikealdo'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>

  </article>


        <footer>
          <span class="copyright">
            &copy; 2016. All rights reserved. Built with <a href="https://github.com/Kikobeats/uno-zen" target="_blank">Uno Zen</a> under <a href="http://hubpress.io/" target="_blank">HubPress</a>.
          </span>
        </footer>
      </section>
    </main>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>
    <script src="//mikealdo.github.io/themes/uno-zen/assets/js/uno-zen.js?v=1.0.0" type="text/javascript" charset="utf-8"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-72815761-1', 'auto');
    ga('send', 'pageview');

    </script>
  </body>
</html>
